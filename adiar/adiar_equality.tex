\documentclass[english, aspectratio=169]{beamer}
% english is for the language used in standard texts (figures, tables etc)
% aspectratio of 16:9 or set it for more old school to 4:3 (without the ':')

% ---------------------------------------------------------------------------- %
% Load base preamble
% ---------------------------------------------------------------------------- %
\usepackage{import}
\subimport{../preamble/}{beamer.tex}

% ---------------------------------------------------------------------------- %
% Local settings
% ---------------------------------------------------------------------------- %
% https://tex.stackexchange.com/a/20613
\newcommand\hcancel[2][black]{\setbox0=\hbox{$#2$}%
  \rlap{\raisebox{.35\ht0}{\textcolor{#1}{\rule{\wd0}{1pt}}}}#2}

\newcommand{\B}[0]{\ensuremath{\mathbb{B}}}

\newcommand{\sort}[0]{\text{sort}}

\newcommand{\triple}[3]{\ensuremath{(#1, #2, #3)}}
\renewcommand{\arc}[3]{\ensuremath{#1 \xrightarrow{_{#2}} #3}}

% makes \addlegendimage available (typically only available within an
% axis environment):
\def\addlegendimage{\pgfplots@addlegendimage}
\makeatother

% ------------------------------------------------------------------------------
% TITLEPAGE
% ------------------------------------------------------------------------------
\title{
  Efficient Equality Checking\\for Non-Shared Binary Decision Diagrams
}

\author{\textbf{Steffan Christ S\o lvsten}, Jaco van de Pol}

\institute{\includegraphics[width=0.2\linewidth]{../external/aulogo_uk_var2_black.eps}}

\date{\today}

\begin{document}

\titleframe

% Problem:
% We do not have 'shared' BDDs in a single table
% Other packages use O(1) time and I/Os for equality checking

\blankframe

% Simple Solution 'f <-> g == T':
%   With Apply it is O(sort(N^2)). That's not good enough!

\begin{frame}
  \vspace{30pt}
  \begin{center}
    {\huge $f \leftrightarrow g \equiv \top$}
  \end{center}

  \pause
  \vspace{20pt}
  
  \begin{equation*}
    \underbrace{O(\sort(N^2))}_{\texttt{Apply}}
    + \underbrace{O(\sort(N^2))}_{\texttt{Reduce}}
    + \underbrace{O(1))}_{\text{check is } \top}
    = O(\sort(N^2))
  \end{equation*}
\end{frame}

% We need to do better!
%   Optimum would be 2N/B I/Os, i.e. only read each BDD once.

\blankframe

% Recall: Bryant's Theorem on canonicity
%   Isomorphism: ~
%
% Trivial negative cases

\begin{frame}
  \begin{theorem}[Bryant '86]
    Let $\pi$ be a variable order and $f : \B^n \rightarrow \B$ then there
    exists a unique (up to isomorphism) Reduced Ordered Binary Decision
    Diagram representing $f$ with ordering $\pi$.
  \end{theorem}

  \pause

  \vspace{10pt}
  {\bf Trivial cases: $f \not \equiv g$ if there is a mismatch in}

  \begin{tabular}{c l l l}
    {\tiny $\blacksquare$} & $N_f \neq N_g$       & Number of nodes            & $O(1)$ I/Os
    \\
    {\tiny $\blacksquare$} & $L_f \neq L_g$       & Number of levels           & $O(1)$ I/Os
    \\
    {\tiny $\blacksquare$} & $N_{f,i} \neq N_{g,i}$ & Number of nodes on a level & $O(L/B)$ I/Os
    \\
    {\tiny $\blacksquare$} & $L_{f,i} \neq L_{g,i}$ & Label of an $i$th level    & $O(L/B)$ I/Os
  \end{tabular}
    
\end{frame}

% O(sort(N)):
% Assume the isomorphism applies
% Cases we find a violation

\begin{frame}

  \begin{figure}
    \centering

    \begin{tikzpicture}[scale=1, every node/.style={transform shape}]
      \input{anim/isomorphism_local_violation.tex}
    \end{tikzpicture}
  \end{figure}
  
\end{frame}

\begin{frame}

  \texttt{IsIsomorphic($f$, $g$)}
  \begin{itemize}
  \item Check whether root $v_f$ of $f$ and root $v_g$ of $g$ have a local violation.
  \item Check $\mathit{low}(v_f) \sim \mathit{low}(v_g)$ and $\mathit{high}(v_f)
    \sim \mathit{high}(v_g)$ ``recursively''.
  \end{itemize}
  Return \texttt{false} on first violation. If there are no violations then return \texttt{true}.

  \pause
  \begin{equation*}
    \underbrace{O(\sort(N^2))}_{\texttt{Apply}'}
    + \underbrace{\hcancel[gray]{O(\sort(N^2))}}_{\texttt{Reduce}}
    + \underbrace{\hcancel[gray]{O(1))}}_{\text{check is } \top}
    = O(\sort(N^2))
  \end{equation*}
  
\end{frame}

\begin{frame}
  \begin{figure}
    \centering

    \begin{tikzpicture}[scale=0.9, every node/.style={transform shape}]
      \input{tikz/isomorphism_level_fail.tex}
    \end{tikzpicture}
  \end{figure}

  \pause
  Return \texttt{false} if more than $N_{f,i} = N_{g,i}$ pairs of nodes $(v_f,
  v_g)$ are checked on level $i$.

  \begin{equation*}
    O(\sort(N))
  \end{equation*}
  
\end{frame}

% 2 N/B:
%   'Canonicity' of Adiar's BDDs

\blankframe

\begin{frame}
  % TODO: this slide is verbose!

  {\bf Observation}

  \vspace{-10pt}
  The output of \texttt{Reduce} has the following properties

  \begin{itemize}
  \item Nodes on level $i$ have their identifiers \emph{consecutively} numbered
    \begin{equation*}
      \mathit{MAX} - N_{f,i} + 1,
      \dots, \mathit{MAX-1}, \mathit{MAX}
      \enspace .
    \end{equation*}

  \item Nodes on level $i$ are output sorted by their children
    \begin{equation*}
      ((i_1, \mathit{id}_1), \mathit{low}_1, \mathit{high}_1)
      <_{\mathit{lex}(i, \mathit{low}, \mathit{high})}
      ((i_2, \mathit{id}_2), \mathit{low}_2, \mathit{high}_2)
      \enspace ,
    \end{equation*}
    where
    \begin{equation*}
      \forall (i,\mathit{id}) \ :\ (i,\mathit{id}) < \bot < \top
      \enspace
      \footnote{Assuming the BDD is not negated. If that is the case then $(i,\mathit{id}) < \top < \bot$.}
      .
    \end{equation*}
  \end{itemize}
 
\end{frame}

\begin{frame}

  \begin{theorem}
    If $G_f$ and $G_g$ are outputs of \texttt{Reduce}.
    \begin{center}
      $G_f \sim G_g$ $\iff$ For all $i \in [0; N)$ the node $G_f[i]$ matches
      $G_g[i]$ numerically.      
    \end{center}
  \end{theorem}
  \begin{proof}
    $\Leftarrow$ : Must describe the exact same graph.
    
    $\Rightarrow$ : Strong induction on BDD levels bottom-up \dots
  \end{proof}

  \pause
  \begin{corollary}
    If $G_f$ and $G_g$ are outputs of \texttt{Reduce} then $f \equiv g$ is
    computable using $2 \cdot N/B$ I/Os.%
    \footnote<2->{Assuming they are both unnegated (or both negated).}
  \end{corollary}
  
\end{frame}

\begin{frame}

  \begin{figure}
    \centering

    \begin{tikzpicture}[scale=0.9, every node/.style={transform shape}]
      \input{tikz/isomorphism_base_case.tex}
    \end{tikzpicture}

    \caption{Base case: $n$}
  \end{figure}
  
\end{frame}

\begin{frame}
  
  \begin{figure}
    \centering

    \begin{tikzpicture}[scale=0.85, every node/.style={transform shape}]
      \input{tikz/isomorphism_induction_case.tex}
    \end{tikzpicture}

    \caption{Induction case: $i < n$}
  \end{figure}
  
\end{frame}

% Algoritms in practice

\blankframe

\begin{frame}

  \begin{table}
    \centering
    \begin{tabular}{r | l}
      Algorithm                         & Time (s)
      \\ \hline
      $f \leftrightarrow g \equiv \top$ & 0.38
      \\
      $O(\sort(N))$                     & 0.058
      \\
      $2 \cdot N/B$                     & 0.006
    \end{tabular}

    \caption{Checking the (EPFL Benchmark) \emph{voter} circuit's single output
      gate ($\abs{N_f} = \abs{N_g} = 5.76~\text{MiB}$).}
  \end{table}
  
\end{frame}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
